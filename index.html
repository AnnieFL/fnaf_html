<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            user-select: none;
        }
        
        html {
            background-color: black;
            user-select: none;
        }

        body {
            margin: 0px !important;
            overflow: hidden;
        }

        .screen>img {
            width: 100vw;
            height: 100vh;
        }

        .button_left {
            position: absolute;
            left: 0px;
            top: 40vh;
        }

        .button_right {
            position: absolute;
            right: 0px;
            top: 40vh;
        }

        .button>img {
            height: 30vh;
            width: 5vw;
        }

        .button_left_hitbox {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: absolute;
            left: 5px;
            top: 45vh;
            z-index: 999;
            height: 18vh;
            width: 5vw;
        }

        .button_right_hitbox {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: absolute;
            right: 5px;
            top: 45vh;
            z-index: 999;
            height: 18vh;
            width: 5vw;
        }

        .button_hitbox>* {
            height: 8vh;
            width: 5vw;
        }

        .door_left {
            position: absolute;
            left: 5vw;
            transform: rotateY(180deg);
            top: 0px;
        }

        .door_right {
            position: absolute;
            right: 5vw;
            top: 0px;
        }

        .door>img {
            height: 100vh;
            width: 13vw;
        }

        .none {
            display: none;
        }

        .invisible {
            opacity: 0;
        }

        .close_door {
            animation: close_door 50ms linear 0ms forwards;
            transform-origin: top;
        }

        .open_door {
            animation: open_door 50ms linear 0ms forwards;
            transform-origin: top;
        }

        .honk_me {
            position: absolute;
            top: 31vh;
            left: 41vw;
            height: 5vh;
            width: 3vw;
        }

        @keyframes close_door {
            0% {
                transform: scaleY(0);
            }

            100% {
                transform: scaleY(1);
            }
        }

        @keyframes open_door {
            0% {
                transform: scaleY(1);
            }

            100% {
                transform: scaleY(0);
            }
        }

        .camera_map {
            position: absolute;
            bottom: 0px;
            right: 0px;
        }

        .camera_map>img {
            width: 50vw;
            height: 60vh;
        }

        .cam_list {
            position: relative;
        }

        .cam_list>div {
            position: absolute;
            background-color: grey;
            border: 2px solid white;
            color: white;
            width: 50px;
            height: 35px;
            top: -60vh;
            left: 0px;
            cursor: pointer;
        }

        .cam_list>.active_cam {
            animation: cam_blink 1000ms linear 0ms infinite;
        }

        @keyframes cam_blink {
            0% {
                background-color: yellow;
            }

            50% {
                background-color: rgb(92, 92, 0);
            }

            100% {
                background-color: yellow;
            }
        }

        #cam1A {
            top: -56vh;
            left: 15vw;
        }

        #cam1B {
            top: -49vh;
            left: 13vw;
        }

        #cam1C {
            top: -37vh;
            left: 7vw;
        }

        #cam3 {
            top: -21vh;
            left: 5vw;
        }

        #cam5 {
            top: -44vh;
            left: 0vw;
        }

        #cam6 {
            top: -23vh;
            left: 39vw;
        }

        #cam7 {
            top: -44vh;
            left: 40vw;
        }

        #cam2A {
            top: -17vh;
            left: 14vw;
        }

        #cam2B {
            top: -12vh;
            left: 14vw;
        }

        #cam4A {
            top: -17vh;
            left: 27vw;
        }

        #cam4B {
            top: -12vh;
            left: 27vw;
        }
    </style>
    <title>Document</title>
</head>

<body>
    <div class="screen">
        <img id='main' src="./screens/office/office_base.png">
    </div>
    <div class="button button_left">
        <img id='left_buttons' src="./screens/office/buttons/button_base.png">
    </div>
    <div class="button button_right">
        <img id='right_buttons' src="./screens/office/buttons/button_base.png">
    </div>

    <div class="door_left door">
        <img id="left_door" class="invisible open_door" src="./screens/office/doors/door.png" />
    </div>

    <div class="door_right door">
        <img id="right_door" class="invisible open_door" src="./screens/office/doors/door.png" />
    </div>

    <div class="button_left_hitbox button_hitbox">
        <div id="button_left_door_hitbox" onclick="toggleDoor('left')"></div>
        <div id="button_left_light_hitbox" onclick="toggleLight('left')"></div>
    </div>
    <div class="button_right_hitbox button_hitbox">
        <div id="button_right_door_hitbox" onclick="toggleDoor('right')"></div>
        <div id="button_right_light_hitbox" onclick="toggleLight('right')"></div>
    </div>

    <div class="camera_map none" id="camera_map">
        <img src="./icons/map.webp">
        <div class="cam_list">
            <div id="cam1A" class="active_cam" onclick="changeCamera(0)">CAM 1A</div>
            <div id="cam1B" onclick="changeCamera(1)">CAM 1B</div>
            <div id="cam1C" onclick="changeCamera(2)">CAM 1C</div>
            <div id="cam3" onclick="changeCamera(3)">CAM 3</div>
            <div id="cam5" onclick="changeCamera(4)">CAM 5</div>
            <div id="cam6" onclick="changeCamera(5)">CAM 6</div>
            <div id="cam7" onclick="changeCamera(6)">CAM 7</div>
            <div id="cam2A" onclick="changeCamera(7)">CAM 2A</div>
            <div id="cam2B" onclick="changeCamera(8)">CAM 2B</div>
            <div id="cam4A" onclick="changeCamera(9)">CAM 4A</div>
            <div id="cam4B" onclick="changeCamera(10)">CAM 4B</div>
        </div>
    </div>

    <button style="position: absolute; top: 50vw; left:50vw" onclick="toggleCamera()">Toggle Camera</button>

    <div class="honk_me" onclick="playAudio('./noises/honk.mp3')"></div>
</body>
<script>
    var stopRender = false;

    var cameraUp = false;
    var currentCam = 0;

    var camPositions = ['1A', '1B', '1C', '3', '5', '6', '7', '2A', '2B', '4A', '4B'];

    var bonniePos = 0;
    var chicaPos = 0;
    var freddyPos = 0;
    var foxyPos = 0;

    var leftDoorClosed = false;
    var leftLightOn = false;

    var rightDoorClosed = false;
    var rightLightOn = false;

    var bonnieDeath = false;
    var chicaDeath = false;
    var dead = false;

    const BONNIE_AI = 10;
    const CHICA_AI = 10;
    const FOXY_AI = 0;
    const FREDDY_AI = 0;

    function handlekey(e) {
        console.log(e);
    }

    function playAudio(file, options = {}) {
        const audio = document.createElement("audio");
        audio.autoplay = true;
        audio.src = file;
        audio.type = 'audio/mp3';

        const id = `${Math.random() * 999}`
        audio.id = id;

        document.appendChild(audio);

        setTimeout(() => {
            audio.remove();
        }, 5000)

    }

    function stopAudio(name) {

    }

    function toggleDoor(side) {
        if (side == 'left' && !bonnieDeath) {
            leftDoorClosed = !leftDoorClosed;
            document.getElementById('left_door').classList.remove('invisible');
            document.getElementById('left_door').classList.toggle('open_door');
            document.getElementById('left_door').classList.toggle('close_door');
        } else if (side == 'right' && !chicaDeath) {
            rightDoorClosed = !rightDoorClosed;
            document.getElementById('right_door').classList.remove('invisible');
            document.getElementById('right_door').classList.toggle('open_door');
            document.getElementById('right_door').classList.toggle('close_door');
        }
        if ((side === 'left' && !bonnieDeath) || side === 'right' && !chicaDeath) {
            playAudio('./noises/door_slam.mp3');
        } else {
            //playAudio('./noises/dud.mp3');
        }
    }

    function toggleLight(side) {
        if (side == 'left' && !bonnieDeath) {
            rightLightOn = false;
            leftLightOn = !leftLightOn;
            //playAudio('./noises/light.mp3');
        } else if (side == 'right' && !chicaDeath) {
            leftLightOn = false;
            rightLightOn = !rightLightOn;
            //playAudio('./noises/light.mp3');
        } else {
            leftLightOn = false;
            rightLightOn = false;
            //playAudio('./noises/dud.mp3');
        }
    }

    function toggleCamera() {
        //playAudio('./noises/camera_flip.mp3');
        cameraUp = !cameraUp;

        document.getElementById('camera_map').classList.toggle('none');
        document.getElementById('left_door').classList.toggle('invisible');
        document.getElementById('right_door').classList.toggle('invisible');
        document.getElementById('left_buttons').classList.toggle('none');
        document.getElementById('right_buttons').classList.toggle('none');
    }

    function changeCamera(camera) {
        //playAudio('./noises/camera_swap.mp3');
        document.getElementById(`cam${camPositions[currentCam]}`).classList.remove('active_cam');

        currentCam = camera;

        document.getElementById(`cam${camPositions[currentCam]}`).classList.add('active_cam');

    }

    function randomBonnie() {
        setTimeout(() => {
            if (Math.random() * 20 <= BONNIE_AI) {
                if (bonniePos == -1 && !leftDoorClosed) {
                    leftLightOn = false;
                    bonnieDeath = true;
                } else if (bonniePos == -1 && leftDoorClosed) {
                    bonniePos = 1;
                } else {
                    if (bonniePos == 0) {
                        bonniePos = Math.floor(Math.random() * 2) % 2 == 0 ? 1 : 4;
                    } else if (bonniePos == 1) {
                        bonniePos = Math.floor(Math.random() * 2) % 2 == 0 ? 4 : 7;
                    } else if (bonniePos == 4) {
                        bonniePos = Math.floor(Math.random() * 2) % 2 == 0 ? 1 : 7;
                    } else if (bonniePos == 7) {
                        bonniePos = Math.floor(Math.random() * 2) % 2 == 0 ? 3 : 8;
                    } else if (bonniePos == 3) {
                        bonniePos = Math.floor(Math.random() * 2) % 2 == 0 ? 7 : -1;
                    } else if (bonniePos == 8) {
                        bonniePos = Math.floor(Math.random() * 2) % 2 == 0 ? 3 : -1;
                    }
                }
            }
            randomBonnie();
        }, 4000)
    }

    function randomChica() {
        setTimeout(() => {
            if (Math.random() * 20 <= CHICA_AI) {
                if (chicaPos == -1 && !rightDoorClosed) {
                    rightLightOn = false;
                    chicaDeath = true;
                } else if (chicaPos == -1 && rightDoorClosed) {
                    chicaPos = 9;
                } else {
                    if (chicaPos == 0 && bonniePos != 0) {
                        chicaPos = 1;
                    } else if (chicaPos == 1) {
                        chicaPos = Math.floor(Math.random() * 2) % 2 == 0 ? 6 : 5;
                        if (chicaPos == 6) {
                            //playAudio('./noises/pots_pans.mp3', {repeat: 'pots_pans'})
                        }
                    } else if (chicaPos == 6) {
                        chicaPos = Math.floor(Math.random() * 2) % 2 == 0 ? 5 : 9;
                        //stopAudio('pots_pans')
                    } else if (chicaPos == 5) {
                        chicaPos = Math.floor(Math.random() * 2) % 2 == 0 ? 6 : 9;
                        if (chicaPos == 6) {
                            //playAudio('./noises/pots_pans.mp3', {repeat: 'pots_pans'})
                        }
                    } else if (chicaPos == 9) {
                        chicaPos = Math.floor(Math.random() * 2) % 2 == 0 ? 10 : 1;
                    } else if (chicaPos == 10) {
                        chicaPos = Math.floor(Math.random() * 2) % 2 == 0 ? 9 : -1;
                    }
                }
            }
            randomChica();
        }, 4000)
    }

    function randomFoxy() {
        setTimeout(() => {
            if (Math.random() * 20 <= FOXY_AI) {
                foxyPos++;
            }
            randomFoxy();
        }, 4000)
    }

    function tryJumpscare() {
        setTimeout(() => {
            if ((chicaDeath || bonnieDeath) && cameraUp) {
                dead = true;
                setTimeout(() => {
                    if (cameraUp) {
                        toggleCamera();
                    }
                    let officeImage = '';

                    stopRender = true;
                    document.getElementById('left_door').classList.add('invisible');
                    document.getElementById('right_door').classList.add('invisible');
                    document.getElementById('left_buttons').classList.add('none');
                    document.getElementById('right_buttons').classList.add('none');

                    if (bonnieDeath && !chicaDeath) {
                        officeImage = './screens/jumpscares/bonnie_jump.webp';
                    } else if (chicaDeath && !bonnieDeath) {
                        officeImage = './screens/jumpscares/chica_jump.webp';
                    } else if (chicaDeath && bonnieDeath) {
                        officeImage = Math.floor(Math.random() * 10) % 2 == 0 ? './screens/jumpscares/bonnie_jump.webp' : './screens/jumpscares/chica_jump.webp';
                    }

                    document.getElementById('main').src = officeImage;
                    setTimeout(() => {
                        document.body.classList.add('none');
                    }, 1000)
                }, Math.floor(Math.random() * 3000));
            }

            if (!dead) {
                tryJumpscare();
            }
        }, 10);
    }

    function render() {
        setTimeout(() => {
            if (!cameraUp) {
                let leftButtonImage = "./screens/office/buttons/button_base_left.png";
                let rightButtonImage = "./screens/office/buttons/button_base_right.png";

                let officeImage = "./screens/office/office_base.png";

                if (leftDoorClosed && leftLightOn && !bonnieDeath) {
                    leftButtonImage = './screens/office/buttons/button_door_light_left.png';
                } else if (leftDoorClosed) {
                    leftButtonImage = './screens/office/buttons/button_door_left.png';
                } else if (leftLightOn) {
                    leftButtonImage = './screens/office/buttons/button_light_left.png';
                }

                if (rightDoorClosed && rightLightOn && !chicaDeath) {
                    rightButtonImage = './screens/office/buttons/button_door_light_right.png';
                } else if (rightDoorClosed) {
                    rightButtonImage = './screens/office/buttons/button_door_right.png';
                } else if (rightLightOn) {
                    rightButtonImage = './screens/office/buttons/button_light_right.png';
                }

                if (leftLightOn) {
                    if (bonniePos == -1) {
                        officeImage = './screens/office/office_bonnie.png';
                    } else {
                        officeImage = './screens/office/office_left.png';
                    }
                } else if (rightLightOn) {
                    if (chicaPos == -1) {
                        officeImage = './screens/office/office_chica.png';
                    } else {
                        officeImage = './screens/office/office_right.png';
                    }
                }

                if ((leftLightOn || rightLightOn) && Math.random() * 20 <= 2) {
                    officeImage = './screens/office/office_base.png';
                }

                document.getElementById('left_buttons').src = leftButtonImage;
                document.getElementById('right_buttons').src = rightButtonImage;
                document.getElementById('main').src = officeImage;
            } else {
                let currentScreen = `./screens/${camPositions[currentCam]}/cam`;

                if (camPositions[currentCam] != "1C" && camPositions[currentCam] != '6' && !(camPositions[currentCam] == "2A" && foxyPos == 4)) {
                    if (bonniePos == currentCam) {
                        currentScreen += "_bonnie";
                    }
                    if (chicaPos == currentCam) {
                        currentScreen += "_chica";
                    }
                    if (freddyPos == currentCam) {
                        currentScreen += "_freddy";
                    }
                } else if (camPositions[currentCam] == '1C') {
                    currentScreen += `_foxy${foxyPos}`;
                } else if (camPositions[currentCam] == '2A' && foxyPos == 3) {
                    currentScreen += `_foxy_schmoovin`;
                }
                currentScreen += ".png";

                document.getElementById('main').src = currentScreen;
            }

            if (!dead) {
                render();
            }
        }, 10)
    }

    render();
    tryJumpscare();
    randomBonnie();
    randomChica();
    randomFoxy();
</script>

</html>